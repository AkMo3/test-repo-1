name: Create Docker Image

on:
  pull_request:
    branches:
      - main
    types:
      - closed

env:
  PR_NUMBER: ${{ github.event.number }}
  LABELS: ${{ github.context.payload.pull_request.labels }}
      
jobs:
  triage:
    if: github.event.pull_request.merged == true
    permissions:
      contents: read
      pull-requests: read
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3

    
    - name: Fetch Label of PR
      id: label-the-PR
      run: |
        echo $LABELS
        echo $PR_NUMBER
        CURL_RES=$(curl -s -H "Authorization: Bearer ${{ secrets.GH_TOKEN }}" "https://api.github.com/repos/${{ github.repository }}/issues/$PR_NUMBER/labels")
        echo $CURL_RES
        PR_LABELS=$(echo $CURL_RES | jq -r '.[].name' | tr '\n' ',')
        echo "::set-output name=pr-labels::$PR_LABELS"

    - id: create-sushi-image
      if: contains(steps.label-the-PR.outputs.pr-labels, 'sushi')
      run: |
        echo "sushi found"
